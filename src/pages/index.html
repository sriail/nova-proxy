<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nova Proxy</title>
    <!-- Scramjet scripts -->
    <script src="/scram/scramjet.all.js"></script>
    <script src="/baremux/index.js"></script>
    <!-- Ultraviolet scripts -->
    <script src="/uv/uv.bundle.js"></script>
    <script src="/uv.config.js"></script>
    <style>
      :root {
        --nav-bar-height: 49px;
        --bg-color: #ffffff;
        --bg-secondary: #f8f8f8;
        --text-color: #000000;
        --text-secondary: rgba(0, 0, 0, 0.7);
        --border-color: #e0e0e0;
        --border-light: #d0d0d0;
        --border-lighter: #f0f0f0;
        --hover-bg: #e8e8e8;
        --active-bg: #d8d8d8;
        --icon-color: #333333;
        --icon-secondary: #666666;
        --shadow-color: rgba(0, 0, 0, 0.1);
        --shadow-dropdown: rgba(0, 0, 0, 0.15);
      }
      body.dark {
        --bg-color: #1b1b1b;
        --bg-secondary: #2a2a2a;
        --text-color: #ffffff;
        --text-secondary: rgba(255, 255, 255, 0.7);
        --border-color: #3a3a3a;
        --border-light: #4a4a4a;
        --border-lighter: #333333;
        --hover-bg: #3a3a3a;
        --active-bg: #4a4a4a;
        --icon-color: #ffffff;
        --icon-secondary: #aaaaaa;
        --shadow-color: rgba(0, 0, 0, 0.3);
        --shadow-dropdown: rgba(0, 0, 0, 0.4);
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: var(--bg-color);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s, color 0.3s;
      }
      /* Upper Navigation Bar */
      .upper-nav {
        display: flex;
        align-items: center;
        padding: 0.5rem 1rem;
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border-color);
        gap: 0.5rem;
        position: sticky;
        top: 0;
        z-index: 1000;
      }
      .nav-left {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }
      .nav-btn {
        background: var(--bg-color);
        border: 1px solid var(--border-light);
        width: 32px;
        height: 32px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
      }
      .nav-btn:hover {
        background: var(--hover-bg);
      }
      .nav-btn:active {
        background: var(--active-bg);
      }
      .nav-btn svg {
        width: 16px;
        height: 16px;
        stroke: var(--icon-color);
      }
      .nav-btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }
      .nav-url-container {
        flex: 1;
        display: flex;
        align-items: center;
        background: var(--bg-color);
        border: 1px solid var(--border-light);
        border-radius: 20px;
        padding: 0.25rem 0.75rem;
        margin: 0 0.5rem;
      }
      .nav-url-container svg {
        width: 14px;
        height: 14px;
        stroke: var(--icon-secondary);
        margin-right: 0.5rem;
        flex-shrink: 0;
      }
      #nav-url-input {
        border: none;
        outline: none;
        flex: 1;
        font-size: 0.85rem;
        padding: 0.35rem 0;
        background: transparent;
        color: var(--text-color);
      }
      .nav-right {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        position: relative;
      }
      .dropdown-container {
        position: relative;
      }
      .dropdown-menu {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background: var(--bg-color);
        border: 1px solid var(--border-light);
        border-radius: 8px;
        box-shadow: 0 4px 12px var(--shadow-dropdown);
        min-width: 150px;
        z-index: 1001;
        margin-top: 4px;
      }
      .dropdown-menu.show {
        display: block;
      }
      .dropdown-item {
        padding: 0.75rem 1rem;
        cursor: pointer;
        font-size: 0.9rem;
        color: var(--text-color);
        border-bottom: 1px solid var(--border-lighter);
        transition: background 0.2s;
      }
      .dropdown-item:last-child {
        border-bottom: none;
      }
      .dropdown-item:hover {
        background: var(--hover-bg);
      }
      .dropdown-item:first-child {
        border-radius: 8px 8px 0 0;
      }
      .dropdown-item:last-child {
        border-radius: 0 0 8px 8px;
      }
      .container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
        transition: all 0.3s ease;
      }
      .container.iframe-active {
        padding: 0;
      }
      .home-content {
        text-align: center;
        max-width: 600px;
        width: 100%;
      }
      .logo {
        margin-bottom: 1rem;
      }
      .logo svg {
        width: 92px;
        height: 92px;
        stroke: var(--text-color);
        color: var(--text-color);
      }
      h1 {
        color: var(--text-color);
        font-size: 3rem;
        margin-bottom: 0.5rem;
        font-weight: 700;
      }
      .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
      }
      .search-container {
        background: var(--bg-color);
        border-radius: 50px;
        padding: 0.5rem 1.5rem;
        display: flex;
        align-items: center;
        box-shadow: 0 10px 40px var(--shadow-color);
        margin-bottom: 1rem;
        border: 2px solid var(--border-color);
      }
      .search-icon {
        margin-right: 1rem;
      }
      .search-icon svg {
        width: 24px;
        height: 24px;
        stroke: var(--text-color);
      }
      #url-input {
        border: none;
        outline: none;
        flex: 1;
        font-size: 1.1rem;
        padding: 0.75rem 0;
        background: transparent;
        color: var(--text-color);
      }

      .features {
        display: flex;
        gap: 2rem;
        margin-top: 3rem;
        justify-content: center;
        flex-wrap: wrap;
      }
      .feature {
        color: var(--text-color);
        text-align: center;
        opacity: 0.8;
      }
      .feature svg {
        width: 32px;
        height: 32px;
        stroke: var(--text-color);
        margin-bottom: 0.5rem;
      }
      .feature-text {
        font-size: 0.9rem;
      }
      #proxy-frame {
        display: none;
        width: 100%;
        height: calc(100vh - var(--nav-bar-height));
        border: none;
      }
      .iframe-active #proxy-frame {
        display: block;
      }
      .iframe-active .home-content {
        display: none;
      }
      .controls {
        position: fixed;
        top: 1rem;
        right: 1rem;
        display: none;
        gap: 0.5rem;
        z-index: 1000;
      }
      .iframe-active .controls {
        display: none;
      }
      .control-btn {
        background: var(--bg-color);
        border: 2px solid var(--border-color);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 10px var(--shadow-color);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
      }
      .control-btn:hover {
        transform: scale(1.1);
        background: var(--hover-bg);
      }
      .control-btn svg {
        width: 20px;
        height: 20px;
        stroke: var(--text-color);
      }
      .settings-btn {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background: var(--bg-color);
        border: 2px solid var(--border-color);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 10px var(--shadow-color);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
        z-index: 1000;
        text-decoration: none;
      }
      .settings-btn:hover {
        transform: scale(1.1);
        background: var(--hover-bg);
      }
      .settings-btn svg {
        width: 20px;
        height: 20px;
        stroke: var(--text-color);
      }
      .settings-btn {
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Upper Navigation Bar -->
    <nav class="upper-nav">
      <div class="nav-left">
        <!-- Back Button -->
        <button class="nav-btn" id="nav-back" title="Go Back" onclick="navGoBack()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 12l14 0"/>
            <path d="M5 12l6 6"/>
            <path d="M5 12l6 -6"/>
          </svg>
        </button>
        <!-- Forward Button -->
        <button class="nav-btn" id="nav-forward" title="Go Forward" onclick="navGoForward()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 12l14 0"/>
            <path d="M13 18l6 -6"/>
            <path d="M13 6l6 6"/>
          </svg>
        </button>
        <!-- Reload Button -->
        <button class="nav-btn" id="nav-reload" title="Reload" onclick="navReload()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4"/>
            <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4"/>
          </svg>
        </button>
        <!-- Home Button -->
        <button class="nav-btn" id="nav-home" title="Home" onclick="goHome()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M5 12l-2 0l9 -9l9 9l-2 0"/>
            <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7"/>
            <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6"/>
          </svg>
        </button>
      </div>
      <!-- URL Bar -->
      <div class="nav-url-container">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
          <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"/>
          <path d="M21 21l-6 -6"/>
        </svg>
        <input type="text" id="nav-url-input" placeholder="Search or enter URL..." />
      </div>
      <div class="nav-right">
        <!-- Settings Button -->
        <button class="nav-btn" id="nav-settings" title="Settings" onclick="goToSettings()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z"/>
            <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"/>
          </svg>
        </button>
        <!-- Dropdown Menu -->
        <div class="dropdown-container">
          <button class="nav-btn" id="nav-menu" title="More options" onclick="toggleDropdown()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
              <path d="M12 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
              <path d="M12 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/>
            </svg>
          </button>
          <div class="dropdown-menu" id="dropdown-menu">
            <div class="dropdown-item" onclick="goToSettings()">Settings</div>
            <div class="dropdown-item" onclick="goHome()">Home</div>
          </div>
        </div>
      </div>
    </nav>
    <a href="/settings.html" class="settings-btn" title="Settings">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="icon icon-tabler icon-tabler-settings"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        stroke-width="2"
        fill="none"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
        <path d="M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z" />
        <path d="M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" />
      </svg>
    </a>
    <div class="container" id="container">
      <div class="home-content">
        <div class="logo">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="92"
            height="92"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M12 3a12 12 0 0 0 8.5 3a12 12 0 0 1 -8.5 15a12 12 0 0 1 -8.5 -15a12 12 0 0 0 8.5 -3" />
            <path d="M12 3v18" />
            <path d="M12 11l0 .01" />
            <path d="M12 14l0 .01" />
          </svg>
        </div>
        <h1>Nova</h1>
        <p class="subtitle">Fast and secure web proxy</p>

        <div class="search-container">
          <div class="search-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="icon icon-tabler icon-tabler-search"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              stroke-width="2"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" />
              <path d="M21 21l-6 -6" />
            </svg>
          </div>
          <input
            type="text"
            id="url-input"
            placeholder="Search or enter URL..."
          />
        </div>
        <div class="features">
          <div class="feature">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="icon icon-tabler icon-tabler-bolt"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              stroke-width="2"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M13 3l0 7l6 0l-8 11l0 -7l-6 0l8 -11" />
            </svg>
            <div class="feature-text">Fast</div>
          </div>
          <div class="feature">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="icon icon-tabler icon-tabler-lock"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              stroke-width="2"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path
                d="M5 13a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-6z"
              />
              <path d="M11 16a1 1 0 1 0 2 0a1 1 0 0 0 -2 0" />
              <path d="M8 11v-4a4 4 0 1 1 8 0v4" />
            </svg>
            <div class="feature-text">Secure</div>
          </div>
          <div class="feature">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="icon icon-tabler icon-tabler-eye-off"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              stroke-width="2"
              fill="none"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M10.585 10.587a2 2 0 0 0 2.829 2.828" />
              <path
                d="M16.681 16.673a8.717 8.717 0 0 1 -4.681 1.327c-3.6 0 -6.6 -2 -9 -6c1.272 -2.12 2.712 -3.678 4.32 -4.674m2.86 -1.146a9.055 9.055 0 0 1 1.82 -.18c3.6 0 6.6 2 9 6c-.666 1.11 -1.379 2.067 -2.138 2.87"
              />
              <path d="M3 3l18 18" />
            </svg>
            <div class="feature-text">Private</div>
          </div>
        </div>
      </div>
      <iframe id="proxy-frame"></iframe>
      <div class="controls">
        <button class="control-btn" onclick="goHome()" title="Home">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="icon icon-tabler icon-tabler-home"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="2"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path d="M5 12l-2 0l9 -9l9 9l-2 0" />
            <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
            <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
          </svg>
        </button>
      </div>
    </div>
    <!-- Client script handles all proxy logic -->
    <script src="/client.js"></script>
    <script>
      // Allow Enter key to submit on main URL input
      document
        .getElementById("url-input")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            loadUrl();
          }
        });

      // Navigation bar URL input - select all text on click
      const navUrlInput = document.getElementById("nav-url-input");
      navUrlInput.addEventListener("click", function () {
        this.select();
      });

      // Allow Enter key to submit on nav URL input
      navUrlInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          loadNavUrl();
        }
      });

      // Toggle dropdown menu
      function toggleDropdown() {
        const dropdown = document.getElementById("dropdown-menu");
        dropdown.classList.toggle("show");
      }

      // Close dropdown when clicking outside
      document.addEventListener("click", function (e) {
        const dropdown = document.getElementById("dropdown-menu");
        const menuBtn = document.getElementById("nav-menu");
        if (!dropdown.contains(e.target) && !menuBtn.contains(e.target)) {
          dropdown.classList.remove("show");
        }
      });

      // Navigation functions
      function navGoBack() {
        const iframe = document.getElementById("proxy-frame");
        if (iframe && iframe.contentWindow) {
          try {
            iframe.contentWindow.history.back();
          } catch (e) {
            console.log("Cannot navigate back:", e);
          }
        }
      }

      function navGoForward() {
        const iframe = document.getElementById("proxy-frame");
        if (iframe && iframe.contentWindow) {
          try {
            iframe.contentWindow.history.forward();
          } catch (e) {
            console.log("Cannot navigate forward:", e);
          }
        }
      }

      function navReload() {
        const iframe = document.getElementById("proxy-frame");
        if (iframe && iframe.contentWindow) {
          try {
            iframe.contentWindow.location.reload();
          } catch (e) {
            console.log("Cannot reload:", e);
          }
        }
      }

      // Helper function to get or create the proxy iframe
      function getOrCreateProxyIframe() {
        const container = document.getElementById("container");
        container.classList.add("iframe-active");
        let iframe = document.getElementById("proxy-frame");
        if (!iframe) {
          iframe = document.createElement("iframe");
          iframe.id = "proxy-frame";
          // CSS handles styling via #proxy-frame selector
          container.appendChild(iframe);
        }
        return iframe;
      }

      function goToSettings() {
        const dropdown = document.getElementById("dropdown-menu");
        dropdown.classList.remove("show");
        // Navigate to settings page directly (not in iframe)
        window.location.href = "/settings.html";
      }

      // Load URL from navigation bar
      function loadNavUrl() {
        const input = navUrlInput.value.trim().toLowerCase();
        
        // Handle nova: special URLs
        if (input === "nova:home") {
          goHome();
          return;
        }
        if (input === "nova:settings") {
          goToSettings();
          return;
        }
        if (input === "nova:error") {
          navUrlInput.value = "nova:error";
          const iframe = getOrCreateProxyIframe();
          iframe.src = "/error.html";
          iframe.style.display = "block";
          return;
        }
        
        // Regular URL handling
        const urlInput = document.getElementById("url-input");
        urlInput.value = navUrlInput.value.trim();
        loadUrl();
      }

      // Update nav URL bar when navigating (called from client.js)
      window.updateNavUrlBar = function(url) {
        navUrlInput.value = url || "";
      };

      // Theme management
      const THEME_KEY = 'nova-theme';
      
      function applyTheme() {
        const theme = localStorage.getItem(THEME_KEY) || 'system';
        
        if (theme === 'dark') {
          document.body.classList.add('dark');
        } else if (theme === 'light') {
          document.body.classList.remove('dark');
        } else {
          // System theme - check if system prefers dark
          if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark');
          } else {
            document.body.classList.remove('dark');
          }
        }
      }
      
      // Apply theme on load
      applyTheme();
      
      // Listen for system theme changes
      if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
          const currentTheme = localStorage.getItem(THEME_KEY) || 'system';
          if (currentTheme === 'system') {
            applyTheme();
          }
        });
      }
    </script>
  </body>
</html>
